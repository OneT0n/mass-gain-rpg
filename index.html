<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mass Gain RPG">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiBmaWxsPSIjMDAwMDAwIiByeD0iNDAiLz4KPHN2ZyB4PSI0MCIgeT0iNDAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyIj4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Ik02LjUgNi41aDExdjExaC0xMXoiLz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+">
    <title>Mass Gain RPG</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.25.6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(180deg, #000000, #111111);
            color: white;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 255, 255, 0.8), 0 0 40px rgba(255, 255, 255, 0.4); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        .shake-animation {
            animation: shake 0.5s ease-in-out;
        }
        
        .notification-enter {
            animation: slideInTop 0.5s ease-out;
        }
        
        @keyframes slideInTop {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        html, body, #root {
            height: 100vh;
            width: 100vw;
            overflow-x: hidden;
        }
        
        .muscle-glow {
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.7), 0 0 40px rgba(255, 255, 255, 0.3);
            animation: muscle-pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes muscle-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.7), 0 0 40px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.9), 0 0 60px rgba(255, 255, 255, 0.5); }
        }
        
        .urgent-glow {
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.3);
        }
        
        .progress-bar {
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .current-task {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }
        
        .completed-task {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .locked-task {
            background: rgba(75, 85, 99, 0.1);
            border: 1px solid rgba(75, 85, 99, 0.2);
        }

        .notification-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(200, 200, 200, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            animation: slideInTop 0.5s ease-out;
            color: black;
        }

        .streak-fire {
            animation: fire-flicker 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes fire-flicker {
            0% { transform: scale(1) rotate(-2deg); }
            100% { transform: scale(1.1) rotate(2deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const { createRoot } = ReactDOM;

        // Icons (все оригинальные иконки сохранены)
        const Dumbbell = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M6.5 6.5h11v11h-11z"/>
                <path d="M4 12h2"/>
                <path d="M18 12h2"/>
                <path d="M12 4v2"/>
                <path d="M12 18v2"/>
            </svg>
        );
        const Target = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="6"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
        );
        const TrendingUp = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polyline points="22,7 13.5,15.5 8.5,10.5 2,17"/>
                <polyline points="16,7 22,7 22,13"/>
            </svg>
        );
        const Trophy = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="8" y1="21" x2="16" y2="21"/>
                <line x1="12" y1="17" x2="12" y2="21"/>
                <path d="M7 4V2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v2"/>
                <path d="M7 4h10v9a3 3 0 0 1-3 3H10a3 3 0 0 1-3-3V4Z"/>
            </svg>
        );
        const Droplet = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
            </svg>
        );
        const Moon = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
        );
        const Utensils = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/>
                <path d="M7 2v20"/>
                <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"/>
            </svg>
        );
        const Activity = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
            </svg>
        );
        const Clock = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
        );
        const CheckCircle = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
        );
        const X = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );
        const Book = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
            </svg>
        );
        const Zap = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/>
            </svg>
        );
        const Heart = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
        );
        const Info = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
        );
        const Home = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9,22 9,12 15,12 15,22"/>
            </svg>
        );
        const Pill = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M10.5 20.5 20.5 10.5a7.5 7.5 0 1 0-10.6 0Z"/>
                <path d="M3.5 13.5 13.5 3.5a7.5 7.5 0 1 1 10.6 10.6Z"/>
            </svg>
        );
        const Star = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
            </svg>
        );
        const Bell = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
            </svg>
        );
        const Settings = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
        );
        const Calendar = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );
        const Volume2 = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polygon points="11,5 6,9 2,9 2,15 6,15 11,19"/>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
            </svg>
        );
        const Fire = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>
            </svg>
        );
        const Timer = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="10" y1="2" x2="14" y2="2"/>
                <line x1="12" y1="14" x2="15" y2="11"/>
                <circle cx="12" cy="14" r="8"/>
            </svg>
        );

        const MassGainApp = () => {
            // Основные состояния
            const [player, setPlayer] = useState({
                name: "Масс Гейнер",
                level: 1,
                currentWeight: 55,
                exp: 0,
                expToNext: 100,
                strength: 10,
                muscle: 8,
                energy: 6,
                discipline: 12,
                massPoints: 0,
                tasksCompleted: 0,
                streak: 0,
                totalWaterGlasses: 0,
                totalIceSessions: 0,
                penaltyMultiplier: 1.0,
                lastPenaltyDate: null,
                perfectDays: 0,
                missedTasks: 0,
                totalDays: 1,
                currentStreak: 0,
                bestStreak: 0
            });

            // Новые состояния
            const [achievements, setAchievements] = useState([]);
            const [completedToday, setCompletedToday] = useState([]);
            const [showPlan, setShowPlan] = useState(false);
            const [expandedQuest, setExpandedQuest] = useState(null);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [showSuccessAnimation, setShowSuccessAnimation] = useState(false);
            const [notifications, setNotifications] = useState([]);
            const [notificationPermission, setNotificationPermission] = useState('default');
            const [settings, setSettings] = useState({
                notificationsEnabled: true,
                soundEnabled: true,
                vibrationEnabled: true,
                reminderInterval: 5 // минут до задания
            });
            const [showSettings, setShowSettings] = useState(false);
            const [weeklyStats, setWeeklyStats] = useState({
                completedDays: 0,
                totalTasks: 0,
                avgCompletion: 0
            });
            const [showCalendar, setShowCalendar] = useState(false);
            const [completedDates, setCompletedDates] = useState({});
            const [installPrompt, setInstallPrompt] = useState(null);
            const [isStandalone, setIsStandalone] = useState(false);
            const [deviceInfo, setDeviceInfo] = useState({
                isIOS: false,
                isAndroid: false,
                isPWAInstalled: false
            });
            
            // Определение устройства и PWA статуса
            useEffect(() => {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isAndroid = /Android/.test(navigator.userAgent);
                const isPWAInstalled = window.matchMedia('(display-mode: standalone)').matches;
                
                setDeviceInfo({ isIOS, isAndroid, isPWAInstalled });
                setIsStandalone(isPWAInstalled);
            }, []);
            
            // Рефы для уведомлений (упрощенные)
            const lastNotificationQuest = useRef(null);

            // Звуки для уведомлений (Web Audio API)
            const playNotificationSound = useCallback(() => {
                if (!settings.soundEnabled) return;
                
                try {
                    // Создаем простой звук уведомления
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (error) {
                    console.log('Звук недоступен:', error);
                }
            }, [settings.soundEnabled]);

            // Тактильная обратная связь для iPhone
            const hapticFeedback = useCallback((type = 'light') => {
                if (navigator.vibrate) {
                    switch(type) {
                        case 'light':
                            navigator.vibrate(10);
                            break;
                        case 'medium':
                            navigator.vibrate(20);
                            break;
                        case 'heavy':
                            navigator.vibrate([30, 10, 30]);
                            break;
                        case 'success':
                            navigator.vibrate([100, 50, 100, 50, 100]);
                            break;
                    }
                }
            }, []);

            // Обратная совместимость
            const vibrate = useCallback(() => {
                hapticFeedback('medium');
            }, [hapticFeedback]);

            // Детектирование жестов для мобильных устройств (упрощенно)
            const [touchStart, setTouchStart] = useState(null);

            const handleTouchStart = (e) => {
                setTouchStart(e.targetTouches[0].clientX);
            };

            const handleTouchEnd = (e) => {
                if (!touchStart) return;
                const touchEnd = e.changedTouches[0].clientX;
                const distance = touchStart - touchEnd;
                
                if (Math.abs(distance) > 50) {
                    hapticFeedback('light');
                }
            };

            // Запрос разрешений на уведомления
            const requestNotificationPermission = useCallback(async () => {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    setNotificationPermission(permission);
                    return permission === 'granted';
                }
                return false;
            }, []);

            // Показать всплывающее уведомление
            const showNotification = useCallback((quest, type = 'new') => {
                if (!settings.notificationsEnabled) return;

                const messages = {
                    'new': `⏰ Новое задание доступно!`,
                    'reminder': `🔔 Не забудь выполнить задание!`,
                    'completed': `✅ Задание выполнено! +${quest.exp} EXP`
                };

                const notification = {
                    id: Date.now(),
                    title: messages[type],
                    message: quest.title,
                    time: quest.time,
                    type: type,
                    quest: quest
                };

                setNotifications(prev => [...prev, notification]);

                // Звук и тактильная обратная связь
                playNotificationSound();
                vibrate();

                // Браузерное уведомление
                if (notificationPermission === 'granted' && 'Notification' in window) {
                    try {
                        new Notification(notification.title, {
                            body: `${quest.time} - ${quest.title}`,
                            icon: '/favicon.ico',
                            badge: '/favicon.ico',
                            tag: `quest-${quest.id}`,
                            requireInteraction: true
                        });
                    } catch (error) {
                        console.log('Браузерное уведомление недоступно:', error);
                    }
                }

                // Автоматически скрыть через 5 секунд
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== notification.id));
                }, 5000);

            }, [settings.notificationsEnabled, notificationPermission, playNotificationSound, vibrate]);

            // Удалить уведомление
            const dismissNotification = useCallback((id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            }, []);

            // ВСЕ 25 ЗАДАНИЙ (сохранены оригинальные)
            const dailyQuests = [
                {
                    id: 1,
                    time: "08:00",
                    title: "Проснуться и выпить воды",
                    icon: <Droplet className="text-white" size={16} />,
                    exp: 10, stats: { energy: 1, discipline: 1 }, mp: 5,
                    details: "Сразу после подъема выпей 1-2 стакана воды. Запускает метаболизм и гидратирует после 8 часов без воды.",
                    category: "morning"
                },
                {
                    id: 2,
                    time: "08:15",
                    title: "Лед для лица + утренняя гигиена",
                    icon: <Heart className="text-white" size={16} />,
                    exp: 15, stats: { energy: 2, discipline: 1 }, mp: 10,
                    details: "ЛИЦО: массируй кубиком льда 3-5 минут круговыми движениями. Убирает отеки, улучшает кровообращение, делает скулы четче. Потом умойся и почисти зубы.",
                    category: "morning"
                },
                {
                    id: 3,
                    time: "08:35",
                    title: "Креатин + витамины",
                    icon: <Pill className="text-white" size={16} />,
                    exp: 8, stats: { muscle: 2 }, mp: 6,
                    details: "5г креатина + витамин D3 + омега-3. Креатин дает энергию мышцам, D3 для тестостерона, омега-3 для суставов.",
                    category: "morning"
                },
                {
                    id: 4,
                    time: "08:45",
                    title: "Взвеситься и замеры",
                    icon: <Target className="text-white" size={16} />,
                    exp: 10, stats: { discipline: 2 }, mp: 8,
                    details: "Взвешивайся утром натощак. Раз в неделю меряй грудь, руки, талию. Записывай результаты.",
                    category: "morning"
                },
                {
                    id: 5,
                    time: "09:00",
                    title: "Супер завтрак",
                    icon: <Utensils className="text-white" size={16} />,
                    exp: 30, stats: { energy: 3, muscle: 3, discipline: 2 }, mp: 25,
                    details: "3 яйца + 2-3 куска хлеба с маслом + банан + стакан молока. 700+ калорий! Основа набора массы - НЕ ПРОПУСКАЙ!",
                    category: "morning"
                },
                {
                    id: 6,
                    time: "09:30",
                    title: "Дополнительная вода",
                    icon: <Droplet className="text-white" size={16} />,
                    exp: 5, stats: { energy: 1 }, mp: 3,
                    details: "Еще стакан воды. Цель: 2.5-3 литра в день. Вода = рост мышц + красивая кожа лица.",
                    category: "morning"
                },
                {
                    id: 7,
                    time: "10:00",
                    title: "Уборка комнаты",
                    icon: <Home className="text-white" size={16} />,
                    exp: 12, stats: { discipline: 2, energy: 1 }, mp: 8,
                    details: "Заправь кровать, собери мусор, протри пыль. Чистота = ясность мыслей = больше дисциплины.",
                    category: "day"
                },
                {
                    id: 8,
                    time: "10:30",
                    title: "Перекус + вода",
                    icon: <Utensils className="text-white" size={16} />,
                    exp: 15, stats: { energy: 2, muscle: 1 }, mp: 12,
                    details: "Молоко + банан + орехи ИЛИ бутерброд с мясом. Не дай организму голодать. Выпей стакан воды.",
                    category: "day"
                },
                {
                    id: 9,
                    time: "11:00",
                    title: "Легкая активность",
                    icon: <Activity className="text-white" size={16} />,
                    exp: 12, stats: { strength: 1, energy: 1 }, mp: 8,
                    details: "10-15 отжиманий ИЛИ вис на турнике 30-60 сек. Активируешь мышцы, готовишь тело к тренировке.",
                    category: "day"
                },
                {
                    id: 10,
                    time: "11:30",
                    title: "Массаж лица руками",
                    icon: <Heart className="text-white" size={16} />,
                    exp: 8, stats: { discipline: 1 }, mp: 6,
                    details: "Круговые движения от центра к краям, легкие похлопывания. Улучшает кровообращение лица.",
                    category: "day"
                },
                {
                    id: 11,
                    time: "12:00",
                    title: "Обед чемпиона",
                    icon: <Utensils className="text-white" size={16} />,
                    exp: 35, stats: { energy: 3, muscle: 4, discipline: 2 }, mp: 30,
                    details: "150-200г мяса/курицы + рис/гречка + овощи + масло. 800+ калорий. Основной прием пищи дня!",
                    category: "day"
                },
                {
                    id: 12,
                    time: "13:00",
                    title: "Послеобеденный отдых",
                    icon: <Droplet className="text-white" size={16} />,
                    exp: 5, stats: { energy: 1 }, mp: 3,
                    details: "Выпей воды, можешь полежать 10-15 минут для лучшего пищеварения.",
                    category: "day"
                },
                {
                    id: 13,
                    time: "14:00",
                    title: "Предтренировочный перекус",
                    icon: <Utensils className="text-white" size={16} />,
                    exp: 18, stats: { energy: 2, muscle: 1 }, mp: 15,
                    details: "Творог 150г + фрукт ИЛИ банан + молоко. За час до тренировки. Энергия без тяжести в животе.",
                    category: "pre-workout"
                },
                {
                    id: 14,
                    time: "14:30",
                    title: "Растяжка шеи и плеч",
                    icon: <Activity className="text-white" size={16} />,
                    exp: 10, stats: { energy: 1, discipline: 1 }, mp: 8,
                    details: "Наклоны головы в стороны, круговые движения плечами. Лучшая осанка = более привлекательный вид.",
                    category: "pre-workout"
                },
                {
                    id: 15,
                    time: "15:00",
                    title: "Предтренировочная вода",
                    icon: <Droplet className="text-white" size={16} />,
                    exp: 8, stats: { energy: 1, discipline: 1 }, mp: 6,
                    details: "Стакан воды за 30 минут до тренировки. Настройся мысленно: сегодня ты станешь сильнее!",
                    category: "pre-workout"
                },
                {
                    id: 16,
                    time: "16:00",
                    title: "Основная тренировка",
                    icon: <Dumbbell className="text-white" size={16} />,
                    exp: 60, stats: { strength: 4, muscle: 5, discipline: 3 }, mp: 50,
                    details: "ПН/СР/ПТ - ВЕРХ: Подтягивания 4x3-5 + Отжимания 3x10-15 + Эспандер 3x15 + Планка. ВТ/ЧТ - НИЗ: Приседания 4x15-20 + Выпады 3x10 + Пресс.",
                    category: "workout"
                },
                {
                    id: 17,
                    time: "16:30",
                    title: "Контрастное умывание",
                    icon: <Droplet className="text-white" size={16} />,
                    exp: 8, stats: { energy: 1 }, mp: 6,
                    details: "Умывайся теплой и холодной водой попеременно (по 30 сек, 3-4 раза). Тонизирует кожу, сужает поры.",
                    category: "workout"
                },
                {
                    id: 18,
                    time: "17:30",
                    title: "Послетренировочный протеин",
                    icon: <Pill className="text-white" size={16} />,
                    exp: 20, stats: { muscle: 3, energy: 1 }, mp: 18,
                    details: "СРАЗУ после тренировки: протеин 30-40г ИЛИ молоко + банан. Первые 30 минут - анаболическое окно!",
                    category: "post-workout"
                },
                {
                    id: 19,
                    time: "18:00",
                    title: "Душ после тренировки",
                    icon: <Droplet className="text-white" size={16} />,
                    exp: 10, stats: { energy: 1, discipline: 1 }, mp: 8,
                    details: "Теплый душ, последние 1-2 минуты - холодный. Холодная вода улучшает восстановление мышц.",
                    category: "post-workout"
                },
                {
                    id: 20,
                    time: "19:00",
                    title: "Ужин силача",
                    icon: <Utensils className="text-white" size={16} />,
                    exp: 30, stats: { energy: 2, muscle: 3, discipline: 1 }, mp: 25,
                    details: "150-200г белка + картофель/рис + салат с маслом. 700+ калорий. Мышцы растут ночью - дай им материал!",
                    category: "evening"
                },
                {
                    id: 21,
                    time: "20:00",
                    title: "Вечерняя вода",
                    icon: <Droplet className="text-white" size={16} />,
                    exp: 8, stats: { energy: 1 }, mp: 5,
                    details: "Стакан воды. Можешь добавить магний для лучшего сна и расслабления мышц.",
                    category: "evening"
                },
                {
                    id: 22,
                    time: "20:30",
                    title: "Ночной перекус",
                    icon: <Utensils className="text-white" size={16} />,
                    exp: 22, stats: { muscle: 3, energy: 1 }, mp: 18,
                    details: "Творог 150-200г + орехи + мед. Казеин будет питать мышцы всю ночь (8 часов!). Критически важно для роста.",
                    category: "night"
                },
                {
                    id: 23,
                    time: "21:00",
                    title: "Лед для лица вечером",
                    icon: <Heart className="text-white" size={16} />,
                    exp: 12, stats: { discipline: 1 }, mp: 10,
                    details: "Вечерний массаж льдом 3-5 минут. Убирает дневные отеки, подтягивает кожу. Утром проснешься с четкими скулами.",
                    category: "night"
                },
                {
                    id: 24,
                    time: "21:15",
                    title: "Вечерняя гигиена",
                    icon: <Heart className="text-white" size={16} />,
                    exp: 10, stats: { discipline: 2 }, mp: 8,
                    details: "Умойся, почисти зубы. 2-3 раза в неделю используй скраб для лица. Чистая кожа = привлекательность.",
                    category: "night"
                },
                {
                    id: 25,
                    time: "21:35",
                    title: "Подготовка ко сну",
                    icon: <Moon className="text-white" size={16} />,
                    exp: 25, stats: { discipline: 3, energy: 2 }, mp: 20,
                    details: "Убери телефон, приглуши свет, ложись до 22:30. 80% роста мышц происходит во сне! Цель: 8-9 часов сна.",
                    category: "night"
                }
            ];

            // Обновление времени каждую минуту
            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 60000);
                return () => clearInterval(timer);
            }, []);

            // Мониторинг новых заданий для уведомлений (упрощенный)
            useEffect(() => {
                if (!settings.notificationsEnabled) return;

                const availableIndex = getCurrentAvailableQuest();
                const currentQuest = availableIndex >= 0 ? dailyQuests[availableIndex] : null;
                
                if (currentQuest && !completedToday.includes(currentQuest.id)) {
                    // Простая проверка без сложной логики таймеров
                }
            }, [currentTime, completedToday, settings.notificationsEnabled]);

            // Запрос разрешений при первой загрузке
            useEffect(() => {
                if (settings.notificationsEnabled && notificationPermission === 'default') {
                    requestNotificationPermission();
                }
            }, [settings.notificationsEnabled, requestNotificationPermission]);

            // УЛУЧШЕННАЯ функция определения текущего доступного задания
            const getCurrentAvailableQuest = useCallback(() => {
                const now = currentTime;
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                const currentTimeMinutes = currentHour * 60 + currentMinute;
                
                // Конвертация времен заданий в минуты с начала дня
                const questTimesInMinutes = dailyQuests.map(quest => {
                    const [hours, minutes] = quest.time.split(':').map(Number);
                    return hours * 60 + minutes;
                });
                
                // Найти последнее доступное задание
                let availableIndex = -1;
                for (let i = 0; i < questTimesInMinutes.length; i++) {
                    if (currentTimeMinutes >= questTimesInMinutes[i]) {
                        availableIndex = i;
                    } else {
                        break;
                    }
                }
                
                return availableIndex;
            }, [currentTime, dailyQuests]);

            // Получить время до следующего задания
            const getTimeUntilNext = useCallback(() => {
                const availableIndex = getCurrentAvailableQuest();
                const nextIndex = availableIndex + 1;
                
                if (nextIndex >= dailyQuests.length) return null;
                
                const nextQuest = dailyQuests[nextIndex];
                const [hours, minutes] = nextQuest.time.split(':').map(Number);
                const nextTime = new Date(currentTime);
                nextTime.setHours(hours, minutes, 0, 0);
                
                const diff = nextTime - currentTime;
                if (diff < 0) return null;
                
                const minutesLeft = Math.floor(diff / (1000 * 60));
                const hoursLeft = Math.floor(minutesLeft / 60);
                const remainingMinutes = minutesLeft % 60;
                
                if (hoursLeft > 0) {
                    return `${hoursLeft}ч ${remainingMinutes}м`;
                } else {
                    return `${minutesLeft}м`;
                }
            }, [currentTime, getCurrentAvailableQuest, dailyQuests]);

            // Получить ранг
            const getRankInfo = useCallback(() => {
                const weight = player.currentWeight;
                if (weight >= 75) return { rank: "Масс Монстр", next: null, color: "text-white", icon: "🔥" };
                if (weight >= 70) return { rank: "Большой Парень", next: "Достичь 75кг для Масс Монстра", color: "text-white", icon: "💪" };
                if (weight >= 65) return { rank: "Крепыш", next: "Достичь 70кг для Большого Парня", color: "text-white", icon: "🏋️" };
                if (weight >= 60) return { rank: "Новичок+", next: "Достичь 65кг для Крепыша", color: "text-white", icon: "📈" };
                return { rank: "Новичок", next: "Достичь 60кг для Новичок+", color: "text-gray-400", icon: "🌱" };
            }, [player.currentWeight]);

            // Мотивационные фразы
            const getMotivationalQuote = useCallback(() => {
                const quotes = [
                    "Каждое задание = четче скулы!",
                    "Лед + питание = мужественное лицо!",
                    "Через месяц ты себя не узнаешь!",
                    "БАДы не нужны - работает лед и еда!",
                    "От 55кг к 70кг = новая личность!",
                    "Твоя сила растет с каждым днем!",
                    "Дисциплина = свобода выбора!",
                    "Сегодня ты лучше, чем вчера!"
                ];
                return quotes[Math.floor(Math.random() * quotes.length)];
            }, []);

            // УЛУЧШЕННАЯ функция выполнения задания
            const completeQuest = useCallback((questId) => {
                if (completedToday.includes(questId)) return;

                const quest = dailyQuests.find(q => q.id === questId);
                if (!quest) return;

                // Проверяем, доступно ли задание по времени
                const questIndex = dailyQuests.findIndex(q => q.id === questId);
                const availableIndex = getCurrentAvailableQuest();
                
                if (questIndex > availableIndex) {
                    alert("⏰ Это задание еще недоступно! Выполняй задания по времени.");
                    return;
                }

                let newExp = player.exp + quest.exp;
                let newLevel = player.level;
                let newExpToNext = player.expToNext;
                let leveledUp = false;

                // Обработка повышения уровня
                while (newExp >= newExpToNext) {
                    newExp -= newExpToNext;
                    newLevel++;
                    newExpToNext = Math.floor(newExpToNext * 1.2);
                    leveledUp = true;
                }

                // НОВАЯ ЛОГИКА: прогресс веса основан на выполненных заданиях
                const newTasksCompleted = player.tasksCompleted + 1;
                const weightGain = Math.floor(newTasksCompleted / 50) * 0.5; // +0.5кг каждые 50 заданий
                const newWeight = Math.min(55 + weightGain, 80); // Максимум 80кг

                const newPlayer = {
                    ...player,
                    exp: newExp,
                    level: newLevel,
                    expToNext: newExpToNext,
                    currentWeight: newWeight,
                    strength: player.strength + (quest.stats?.strength || 0),
                    muscle: player.muscle + (quest.stats?.muscle || 0),
                    energy: player.energy + (quest.stats?.energy || 0),
                    discipline: player.discipline + (quest.stats?.discipline || 0),
                    massPoints: player.massPoints + quest.mp,
                    tasksCompleted: newTasksCompleted
                };

                setPlayer(newPlayer);
                setCompletedToday(prev => [...prev, questId]);

                // Haptic feedback для успеха
                hapticFeedback('success');

                // Анимация успеха
                setShowSuccessAnimation(true);
                setTimeout(() => setShowSuccessAnimation(false), 2000);

                if (leveledUp) {
                    setTimeout(() => {
                        alert(`🔥 LEVEL UP! Теперь ты ${newLevel} уровня! Сила растет!`);
                    }, 500);
                }

                // Проверка достижений
                checkAchievements(newPlayer, completedToday.length + 1);

            }, [player, completedToday, dailyQuests, getCurrentAvailableQuest, hapticFeedback]);

            // Система достижений
            const checkAchievements = useCallback((newPlayer, completedCount) => {
                const newAchievements = [];
                
                if (completedCount >= 10 && !achievements.includes('first_10')) {
                    newAchievements.push('first_10');
                }
                if (completedCount >= 25 && !achievements.includes('perfect_day')) {
                    newAchievements.push('perfect_day');
                }
                if (newPlayer.level >= 5 && !achievements.includes('level_5')) {
                    newAchievements.push('level_5');
                }
                if (newPlayer.currentWeight >= 60 && !achievements.includes('weight_60')) {
                    newAchievements.push('weight_60');
                }
                
                if (newAchievements.length > 0) {
                    setAchievements(prev => [...prev, ...newAchievements]);
                    hapticFeedback('success');
                    setTimeout(() => {
                        alert(`🏆 ДОСТИЖЕНИЕ ПОЛУЧЕНО! ${newAchievements.length} новых достижений!`);
                    }, 1000);
                }
            }, [achievements, hapticFeedback]);

            // Проверить, доступно ли задание для выполнения
            const isQuestAvailable = useCallback((questIndex) => {
                const availableIndex = getCurrentAvailableQuest();
                return questIndex <= availableIndex;
            }, [getCurrentAvailableQuest]);

            // Получить следующее задание
            const getNextQuest = useCallback(() => {
                const availableIndex = getCurrentAvailableQuest();
                const nextIndex = availableIndex + 1;
                return nextIndex < dailyQuests.length ? dailyQuests[nextIndex] : null;
            }, [getCurrentAvailableQuest, dailyQuests]);

            const rankInfo = getRankInfo();
            const availableQuestIndex = getCurrentAvailableQuest();
            const currentQuest = availableQuestIndex >= 0 ? dailyQuests[availableQuestIndex] : null;
            const nextQuest = getNextQuest();
            const completionPercentage = (completedToday.length / dailyQuests.length) * 100;
            const timeUntilNext = getTimeUntilNext();

            return (
                <div className="min-h-screen bg-gradient-to-br from-black via-gray-900 to-black text-white relative overflow-hidden"
                     onTouchStart={handleTouchStart}
                     onTouchEnd={handleTouchEnd}>
                    {/* Уведомления */}
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {notifications.map((notification) => (
                            <div
                                key={notification.id}
                                className="notification-popup max-w-sm"
                            >
                                <div className="flex items-start justify-between">
                                    <div className="flex-1">
                                        <h4 className="font-bold text-sm">{notification.title}</h4>
                                        <p className="text-xs opacity-90 mt-1">{notification.time} - {notification.message}</p>
                                    </div>
                                    <button 
                                        onClick={() => dismissNotification(notification.id)}
                                        className="ml-2 p-1 rounded-lg hover:bg-white hover:bg-opacity-20 transition-colors"
                                    >
                                        <X size={14} />
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* PWA Install Banner (упрощенный) */}
                    {deviceInfo.isIOS && !isStandalone && (
                        <div className="fixed bottom-4 left-4 right-4 z-50">
                            <div className="glass-effect rounded-2xl p-4 border border-white border-opacity-20">
                                <div className="flex items-center space-x-3">
                                    <div className="text-2xl">📱</div>
                                    <div className="flex-1">
                                        <h4 className="font-bold text-sm">Установить как приложение</h4>
                                        <p className="text-xs text-gray-400">Safari → Поделиться → На экран Домой</p>
                                    </div>
                                    <button 
                                        onClick={() => setDeviceInfo(prev => ({...prev, isIOS: false}))}
                                        className="px-3 py-2 rounded-xl bg-white bg-opacity-20 hover:bg-opacity-30 transition-colors text-xs font-bold"
                                    >
                                        ОК
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    {showSuccessAnimation && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
                            <div className="text-6xl animate-bounce">✅</div>
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                                <div className="text-2xl font-bold text-green-400 animate-pulse">+EXP!</div>
                            </div>
                        </div>
                    )}

                    <div className="relative z-10 p-4 max-w-md mx-auto">
                        {/* УЛУЧШЕННЫЙ заголовок с уведомлениями */}
                        <div className="mb-8 text-center">
                            <div className="flex items-center justify-between mb-4">
                                <button 
                                    onClick={() => setShowPlan(!showPlan)}
                                    className="p-3 rounded-2xl glass-effect hover:bg-opacity-20 transition-all duration-300 float-animation"
                                >
                                    <Book size={18} />
                                </button>
                                <div>
                                    <h1 className="text-2xl font-bold tracking-wider">
                                        MASS GAIN RPG
                                    </h1>
                                    <div className="text-xs text-gray-400 mt-1">
                                        {currentTime.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}
                                    </div>
                                    <div className="text-xs text-white mt-1">
                                        {completionPercentage.toFixed(0)}% выполнено
                                    </div>
                                </div>
                                <button 
                                    onClick={() => setShowSettings(!showSettings)}
                                    className={`p-3 rounded-2xl glass-effect hover:bg-opacity-20 transition-all duration-300 ${
                                        notifications.length > 0 ? 'shake-animation' : ''
                                    }`}
                                >
                                    <Bell size={18} className={settings.notificationsEnabled ? 'text-white' : 'text-gray-400'} />
                                    {notifications.length > 0 && (
                                        <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full flex items-center justify-center text-xs font-bold">
                                            {notifications.length}
                                        </div>
                                    )}
                                </button>
                            </div>
                            <div className="h-px bg-gradient-to-r from-transparent via-white via-opacity-30 to-transparent"></div>
                        </div>

                        {/* Настройки */}
                        {showSettings && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                                <div className="absolute inset-0 bg-black bg-opacity-80 backdrop-blur-lg" onClick={() => setShowSettings(false)}></div>
                                <div className="relative w-full max-w-md glass-effect rounded-3xl p-6">
                                    <div className="flex items-center justify-between mb-6">
                                        <h3 className="text-lg font-bold flex items-center">
                                            <Settings size={18} className="mr-2" />
                                            НАСТРОЙКИ
                                        </h3>
                                        <button 
                                            onClick={() => setShowSettings(false)}
                                            className="p-2 rounded-xl hover:bg-white hover:bg-opacity-10 transition-colors"
                                        >
                                            <X size={18} />
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div className="glass-effect rounded-2xl p-4">
                                            <h4 className="font-semibold mb-3 flex items-center">
                                                <Bell size={16} className="mr-2" />
                                                Уведомления
                                            </h4>
                                            <div className="space-y-3">
                                                <label className="flex items-center justify-between">
                                                    <span className="text-sm">Включить уведомления</span>
                                                    <input 
                                                        type="checkbox"
                                                        checked={settings.notificationsEnabled}
                                                        onChange={(e) => setSettings(prev => ({...prev, notificationsEnabled: e.target.checked}))}
                                                        className="w-4 h-4 rounded"
                                                    />
                                                </label>
                                                <label className="flex items-center justify-between">
                                                    <span className="text-sm">Звук</span>
                                                    <input 
                                                        type="checkbox"
                                                        checked={settings.soundEnabled}
                                                        onChange={(e) => setSettings(prev => ({...prev, soundEnabled: e.target.checked}))}
                                                        className="w-4 h-4 rounded"
                                                    />
                                                </label>
                                                <label className="flex items-center justify-between">
                                                    <span className="text-sm">Вибрация</span>
                                                    <input 
                                                        type="checkbox"
                                                        checked={settings.vibrationEnabled}
                                                        onChange={(e) => setSettings(prev => ({...prev, vibrationEnabled: e.target.checked}))}
                                                        className="w-4 h-4 rounded"
                                                    />
                                                </label>
                                                <div>
                                                    <label className="block text-sm mb-2">Напоминание через:</label>
                                                    <select 
                                                        value={settings.reminderInterval}
                                                        onChange={(e) => setSettings(prev => ({...prev, reminderInterval: Number(e.target.value)}))}
                                                        className="w-full p-2 rounded-lg bg-white bg-opacity-10 text-white"
                                                    >
                                                        <option value={0}>Выключено</option>
                                                        <option value={5}>5 минут</option>
                                                        <option value={10}>10 минут</option>
                                                        <option value={15}>15 минут</option>
                                                        <option value={30}>30 минут</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="glass-effect rounded-2xl p-4">
                                            <h4 className="font-semibold mb-3 flex items-center">
                                                📱 Статус приложения
                                            </h4>
                                            <div className="text-sm text-gray-300">
                                                <p>📱 <strong>Устройство:</strong> {deviceInfo.isIOS ? 'iPhone/iPad' : deviceInfo.isAndroid ? 'Android' : 'Desktop'}</p>
                                                <p>📍 <strong>Режим:</strong> {isStandalone ? 'Приложение' : 'Браузер'}</p>
                                            </div>
                                        </div>
                                        
                                        {settings.notificationsEnabled && (
                                            <div className="mt-4 p-3 rounded-xl bg-white bg-opacity-10">
                                                <p className="text-xs text-gray-400">
                                                    💡 Подсказка: В браузере может появиться запрос на разрешение уведомлений
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* УЛУЧШЕННОЕ модальное окно плана */}
                        {showPlan && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                                <div className="absolute inset-0 bg-black bg-opacity-80 backdrop-blur-lg" onClick={() => setShowPlan(false)}></div>
                                <div className="relative w-full max-w-md glass-effect rounded-3xl p-6 max-h-[80vh] overflow-y-auto">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-lg font-bold">
                                            🎯 ГАРАНТИЯ РЕЗУЛЬТАТА
                                        </h3>
                                        <button 
                                            onClick={() => setShowPlan(false)}
                                            className="p-2 rounded-xl hover:bg-white hover:bg-opacity-10 transition-colors"
                                        >
                                            <X size={18} />
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-4 text-sm">
                                        <div className="glass-effect rounded-2xl p-4">
                                            <h4 className="font-semibold text-white mb-2 flex items-center">
                                                <Trophy size={16} className="mr-2" />
                                                ЧТО ДАСТ ПЛАН
                                            </h4>
                                            <div className="text-xs text-gray-300 space-y-2">
                                                <p>🔥 <strong>+15-20кг за 4 месяца</strong> (из 55кг в 70-75кг)</p>
                                                <p>😎 <strong>Мужественное лицо</strong> - уберет впалость щек</p>
                                                <p>💎 <strong>Четкие скулы</strong> - лед убирает отеки</p>
                                                <p>💪 <strong>Сильное тело</strong> - широкие плечи, рельеф</p>
                                            </div>
                                        </div>
                                        
                                        <div className="glass-effect rounded-2xl p-4">
                                            <h4 className="font-semibold text-white mb-2 flex items-center">
                                                <Heart size={16} className="mr-2" />
                                                СЕКРЕТ СКУЛ (БЕЗ БАДОВ!)
                                            </h4>
                                            <div className="text-xs text-gray-300 space-y-2">
                                                <p>🧊 <strong>Лед 2 раза в день</strong> - убирает отеки</p>
                                                <p>📈 <strong>Набор 15-20кг</strong> - уберет впалость щек</p>
                                                <p>💧 <strong>3+ литра воды</strong> - здоровая кожа</p>
                                                <p>⚡ <strong>БАДы НЕ НУЖНЫ!</strong> Лед работает лучше!</p>
                                            </div>
                                        </div>
                                        
                                        <div className="glass-effect rounded-2xl p-4">
                                            <h4 className="font-semibold text-white mb-2 flex items-center">
                                                <Clock size={16} className="mr-2" />
                                                25 ЗАДАНИЙ НА ДЕНЬ
                                            </h4>
                                            <div className="text-xs text-gray-300 space-y-2">
                                                <p>⏰ <strong>Задания по времени</strong> - нельзя выполнить заранее</p>
                                                <p>🌅 <strong>08:00-12:00</strong> - утренний блок</p>
                                                <p>☀️ <strong>12:00-16:00</strong> - дневной блок</p>
                                                <p>🏋️ <strong>16:00-18:00</strong> - тренировка</p>
                                                <p>🌙 <strong>18:00-22:00</strong> - вечерний блок</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* УЛУЧШЕННАЯ карточка персонажа с стриком */}
                        <div className={`mb-6 glass-effect rounded-3xl p-6 transition-all duration-500 ${
                            player.massPoints >= 500 ? 'muscle-glow' : ''
                        }`}>
                            <div className="flex items-center justify-between mb-4">
                                <div>
                                    <h2 className="text-lg font-bold flex items-center">
                                        {rankInfo.icon} {player.name}
                                        {player.currentStreak > 0 && (
                                            <div className="ml-2 flex items-center">
                                                <Fire size={16} className="text-white streak-fire" />
                                                <span className="text-white font-bold">{player.currentStreak}</span>
                                            </div>
                                        )}
                                    </h2>
                                    <div className="text-xs text-gray-400">Level {player.level} • {player.tasksCompleted} заданий</div>
                                    {player.bestStreak > 0 && (
                                        <div className="text-xs text-white">🔥 Лучший стрик: {player.bestStreak} дней</div>
                                    )}
                                </div>
                                <div className="text-right">
                                    <div className="text-2xl font-bold text-white">
                                        {player.currentWeight} кг
                                    </div>
                                    <div className="text-xs text-gray-400">{player.massPoints} MP</div>
                                </div>
                            </div>
                            
                            <div className="text-center text-sm text-gray-300 mb-4 italic font-medium bg-black bg-opacity-20 rounded-2xl py-2 px-3">
                                "{getMotivationalQuote()}"
                            </div>
                            
                            {/* УЛУЧШЕННАЯ полоса опыта */}
                            <div className="mb-4">
                                <div className="flex justify-between text-xs mb-2 text-gray-400">
                                    <span>ОПЫТ ДО СЛЕДУЮЩЕГО УРОВНЯ</span>
                                    <span>{player.exp} / {player.expToNext}</span>
                                </div>
                                <div className="w-full bg-black bg-opacity-30 rounded-full h-3 overflow-hidden border border-white border-opacity-10 progress-bar">
                                    <div 
                                        className="h-full transition-all duration-1000 ease-out rounded-full"
                                        style={{ 
                                            width: `${Math.min((player.exp / player.expToNext) * 100, 100)}%`,
                                            background: 'linear-gradient(90deg, #ffffff, #cccccc)',
                                            boxShadow: '0 0 15px rgba(255,255,255,0.6)'
                                        }}
                                    ></div>
                                </div>
                            </div>
                            
                            {/* УЛУЧШЕННАЯ сетка характеристик */}
                            <div className="grid grid-cols-2 gap-4">
                                <div className="glass-effect rounded-2xl p-3 text-center">
                                    <Dumbbell className="text-white mx-auto mb-1" size={16} />
                                    <div className="text-xs text-gray-400">СИЛА</div>
                                    <div className="font-bold text-lg">{player.strength}</div>
                                </div>
                                <div className="glass-effect rounded-2xl p-3 text-center">
                                    <Activity className="text-white mx-auto mb-1" size={16} />
                                    <div className="text-xs text-gray-400">МЫШЦЫ</div>
                                    <div className="font-bold text-lg">{player.muscle}</div>
                                </div>
                                <div className="glass-effect rounded-2xl p-3 text-center">
                                    <TrendingUp className="text-white mx-auto mb-1" size={16} />
                                    <div className="text-xs text-gray-400">ЭНЕРГИЯ</div>
                                    <div className="font-bold text-lg">{player.energy}</div>
                                </div>
                                <div className="glass-effect rounded-2xl p-3 text-center">
                                    <Target className="text-white mx-auto mb-1" size={16} />
                                    <div className="text-xs text-gray-400">ДИСЦИПЛИНА</div>
                                    <div className="font-bold text-lg">{player.discipline}</div>
                                </div>
                            </div>
                        </div>

                        {/* УЛУЧШЕННАЯ карточка ранга */}
                        <div className="mb-6 glass-effect rounded-3xl p-6">
                            <h3 className="text-sm font-medium mb-4 flex items-center tracking-wide uppercase">
                                <Trophy className="mr-2 text-white" size={16} />
                                РАНГ БИЛДЕРА
                            </h3>
                            <div className="text-center">
                                <div className={`text-xl font-bold ${rankInfo.color} mb-2`}>
                                    {rankInfo.icon} {rankInfo.rank}
                                </div>
                                <p className="text-xs text-gray-400">{rankInfo.next || "Максимальный ранг достигнут!"}</p>
                                {rankInfo.next && (
                                    <div className="mt-3 w-full bg-black bg-opacity-30 rounded-full h-2">
                                        <div 
                                            className="h-full rounded-full transition-all duration-1000 bg-white"
                                            style={{ 
                                                width: `${((player.currentWeight - 55) / 20) * 100}%`
                                            }}
                                        ></div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* УЛУЧШЕННОЕ текущее задание с таймером */}
                        <div className="mb-6">
                            <h3 className="text-lg font-bold flex items-center justify-between mb-4">
                                <div className="flex items-center">
                                    <Zap className="mr-2 text-white" size={18} />
                                    СЕЙЧАС ДОСТУПНО
                                </div>
                                {timeUntilNext && (
                                    <div className="flex items-center text-sm text-gray-400">
                                        <Timer className="mr-1" size={14} />
                                        {timeUntilNext}
                                    </div>
                                )}
                            </h3>

                            {currentQuest ? (
                                <div className="current-task glass-effect rounded-3xl p-6 animate-pulse-glow">
                                    <div className="flex items-center space-x-3 mb-4">
                                        <div className="p-3 rounded-2xl bg-white bg-opacity-10">
                                            {currentQuest.icon}
                                        </div>
                                        <div className="flex-1">
                                            <div className="text-xl font-bold text-white">{currentQuest.time}</div>
                                            <h4 className="font-semibold text-lg">{currentQuest.title}</h4>
                                            <div className="text-xs text-gray-400">
                                                Задание #{availableQuestIndex + 1} из {dailyQuests.length} • {currentQuest.category}
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => setExpandedQuest(expandedQuest === currentQuest.id ? null : currentQuest.id)}
                                            className="p-3 rounded-2xl hover:bg-white hover:bg-opacity-10 transition-colors"
                                        >
                                            <Info size={16} className="text-gray-400" />
                                        </button>
                                    </div>
                                    
                                    {expandedQuest === currentQuest.id && (
                                        <div className="mb-4 glass-effect rounded-2xl p-4 transition-all duration-300">
                                            <p className="text-sm text-gray-300 leading-relaxed">{currentQuest.details}</p>
                                        </div>
                                    )}
                                    
                                    <div className="flex items-center justify-between text-sm mb-4 glass-effect rounded-2xl p-3">
                                        <span className="text-white">+{currentQuest.exp} EXP</span>
                                        <span className="text-white">+{currentQuest.mp} MP</span>
                                        {currentQuest.stats && Object.entries(currentQuest.stats).map(([stat, value]) => (
                                            <span key={stat} className="text-white">+{value} {stat.slice(0,3).toUpperCase()}</span>
                                        ))}
                                    </div>
                                    
                                    {!completedToday.includes(currentQuest.id) ? (
                                        <button 
                                            onClick={() => completeQuest(currentQuest.id)}
                                            className="w-full py-4 rounded-2xl bg-gradient-to-r from-white to-gray-200 border-2 border-white hover:from-gray-200 hover:to-gray-300 text-lg font-bold transition-all duration-300 text-black shadow-lg hover:shadow-white/25"
                                        >
                                            ✅ ВЫПОЛНИТЬ ЗАДАНИЕ!
                                        </button>
                                    ) : (
                                        <div className="w-full py-4 rounded-2xl completed-task text-lg font-bold text-white text-center">
                                            ✅ ВЫПОЛНЕНО! ОТЛИЧНО!
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="glass-effect rounded-3xl p-6 text-center">
                                    <div className="text-2xl font-bold text-blue-400 mb-3">⏰ СЛИШКОМ РАНО!</div>
                                    <div className="text-sm text-gray-300">
                                        Первое задание начинается в <strong>08:00</strong><br/>
                                        Нельзя выполнять заранее - это нарушает систему!
                                    </div>
                                    {nextQuest && (
                                        <div className="mt-4 glass-effect rounded-2xl p-3">
                                            <div className="text-xs text-gray-400">СЛЕДУЮЩЕЕ ЗАДАНИЕ:</div>
                                            <div className="text-sm font-medium">{nextQuest.time} - {nextQuest.title}</div>
                                            {timeUntilNext && (
                                                <div className="text-xs text-white mt-1">через {timeUntilNext}</div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* УЛУЧШЕННЫЙ список всех заданий с группировкой */}
                        <div className="mb-6">
                            <h3 className="text-lg font-bold flex items-center mb-4">
                                <Clock className="mr-2 text-white" size={18} />
                                ПЛАН НА ДЕНЬ
                            </h3>

                            <div className="space-y-3">
                                {Object.entries(
                                    dailyQuests.reduce((acc, quest, index) => {
                                        const category = quest.category;
                                        if (!acc[category]) acc[category] = [];
                                        acc[category].push({ ...quest, index });
                                        return acc;
                                    }, {})
                                ).map(([category, quests]) => (
                                    <div key={category} className="glass-effect rounded-3xl p-4">
                                        <h4 className="text-sm font-bold text-gray-400 uppercase tracking-wide mb-3">
                                            {category === 'morning' && '🌅 УТРО'}
                                            {category === 'day' && '☀️ ДЕНЬ'}
                                            {category === 'pre-workout' && '⚡ ПЕРЕД ТРЕНИРОВКОЙ'}
                                            {category === 'workout' && '🏋️ ТРЕНИРОВКА'}
                                            {category === 'post-workout' && '💪 ПОСЛЕ ТРЕНИРОВКИ'}
                                            {category === 'evening' && '🌆 ВЕЧЕР'}
                                            {category === 'night' && '🌙 НОЧЬ'}
                                        </h4>
                                        <div className="space-y-2">
                                            {quests.map((quest) => {
                                                const isCompleted = completedToday.includes(quest.id);
                                                const isAvailable = isQuestAvailable(quest.index);
                                                const isCurrent = quest.index === availableQuestIndex;
                                                
                                                return (
                                                    <div 
                                                        key={quest.id} 
                                                        className={`rounded-2xl p-3 transition-all duration-300 ${
                                                            isCompleted ? 'completed-task' : 
                                                            isCurrent ? 'current-task animate-pulse-glow' :
                                                            isAvailable ? 'glass-effect opacity-80' : 'locked-task opacity-40'
                                                        }`}
                                                    >
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex items-center space-x-3">
                                                                <div className={`p-2 rounded-xl ${isCompleted ? 'bg-green-500 bg-opacity-20' : 'bg-white bg-opacity-10'}`}>
                                                                    {quest.icon}
                                                                </div>
                                                                <div>
                                                                    <div className="text-sm font-bold text-white">{quest.time}</div>
                                                                    <div className="text-sm font-medium">{quest.title}</div>
                                                                </div>
                                                            </div>
                                                            <div className="text-right flex flex-col items-center">
                                                                {isCompleted ? (
                                                                    <CheckCircle size={20} className="text-white" />
                                                                ) : isCurrent ? (
                                                                    <div className="text-xs text-black font-bold bg-white bg-opacity-90 px-2 py-1 rounded-full">
                                                                        СЕЙЧАС
                                                                    </div>
                                                                ) : isAvailable ? (
                                                                    <div className="text-xs text-black font-bold bg-gray-400 bg-opacity-90 px-2 py-1 rounded-full">
                                                                        ДОСТУПНО
                                                                    </div>
                                                                ) : (
                                                                    <Clock size={16} className="text-gray-500" />
                                                                )}
                                                                <div className="text-xs text-gray-500 mt-1">
                                                                    +{quest.exp}exp
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* УЛУЧШЕННЫЙ прогресс дня */}
                        <div className="glass-effect rounded-3xl p-6">
                            <h3 className="text-sm font-medium mb-4 flex items-center tracking-wide uppercase">
                                <Trophy className="mr-2 text-yellow-400" size={16} />
                                ПРОГРЕСС ДНЯ
                            </h3>
                            <div className="space-y-4">
                                <div className="grid grid-cols-3 gap-3">
                                    <div className="text-center glass-effect rounded-2xl p-3">
                                        <div className="text-xl font-bold text-green-400">{completedToday.length}</div>
                                        <div className="text-xs text-gray-400">ВЫПОЛНЕНО</div>
                                    </div>
                                    <div className="text-center glass-effect rounded-2xl p-3">
                                        <div className="text-xl font-bold text-yellow-400">{availableQuestIndex + 1}</div>
                                        <div className="text-xs text-gray-400">ДОСТУПНО</div>
                                    </div>
                                    <div className="text-center glass-effect rounded-2xl p-3">
                                        <div className="text-xl font-bold text-blue-400">{dailyQuests.length - completedToday.length}</div>
                                        <div className="text-xs text-gray-400">ОСТАЛОСЬ</div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div className="flex justify-between text-sm mb-2">
                                        <span className="text-gray-400">Общий прогресс:</span>
                                        <span className="text-white font-bold">{completionPercentage.toFixed(1)}%</span>
                                    </div>
                                    <div className="w-full bg-black bg-opacity-30 rounded-full h-4 mt-3 progress-bar border border-white border-opacity-10">
                                        <div 
                                            className="h-full transition-all duration-1000 rounded-full flex items-center justify-center text-xs font-bold text-white"
                                            style={{ 
                                                width: `${Math.max(completionPercentage, 5)}%`,
                                                background: completionPercentage === 100 
                                                    ? 'linear-gradient(90deg, #ffffff, #cccccc)' 
                                                    : 'linear-gradient(90deg, #ffffff, #cccccc)',
                                                boxShadow: completionPercentage === 100 
                                                    ? '0 0 20px rgba(255, 255, 255, 0.6)' 
                                                    : '0 0 10px rgba(255, 255, 255, 0.6)'
                                            }}
                                        >
                                            {completionPercentage >= 20 && `${completionPercentage.toFixed(0)}%`}
                                        </div>
                                    </div>
                                </div>
                                
                                {completionPercentage === 100 && (
                                    <div className="text-center mt-4 glass-effect rounded-2xl p-4 muscle-glow">
                                        <div className="text-2xl font-bold text-white mb-2">🎉 ИДЕАЛЬНЫЙ ДЕНЬ!</div>
                                        <div className="text-sm text-gray-300">Все 25 заданий выполнены! Ты чемпион!</div>
                                        <div className="text-xs text-white mt-2">+БОНУС К РОСТУ МЫШЦ!</div>
                                        <div className="flex items-center justify-center mt-2">
                                            <Fire size={16} className="text-white streak-fire mr-1" />
                                            <span className="text-white font-bold">СТРИК +1!</span>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<MassGainApp />);
    </script>
</body>
</html>
